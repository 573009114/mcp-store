# MCP工具注解文档

## 概述

本文档总结了为Linux MCP Server中所有工具添加的详细注解，这些注解帮助大模型更好地理解每个工具的用途、参数和使用方法。

## 主要工具分类

### 1. 系统操作工具

#### shell - 执行Shell命令工具
- **功能描述**: 在本地或远程主机上执行任意Shell命令，支持本地执行和远程SSH执行
- **适用场景**: 系统管理、文件操作、网络诊断等
- **参数**: 
  - `command`: 要执行的Shell命令
  - `host_id`: 远程主机ID（可选）
- **使用示例**: 
  - 本地执行: `shell("ls -la")`
  - 远程执行: `shell("ps aux", host_id=1)`

#### systemd - Systemd服务管理工具
- **功能描述**: 管理系统服务，包括启动、停止、重启、查看状态等操作
- **适用场景**: 服务部署和维护
- **参数**:
  - `action`: 操作类型（start/stop/restart/status/enable/disable/reload）
  - `service`: 服务名称
  - `host_id`: 远程主机ID（可选）
- **使用示例**:
  - 启动服务: `systemd("start", "nginx")`
  - 查看状态: `systemd("status", "mysql")`

#### logs - 日志查看工具
- **功能描述**: 查看指定文件的最后几行内容，常用于查看日志文件的最新记录
- **适用场景**: 日志分析和问题排查
- **参数**:
  - `path`: 文件路径
  - `lines`: 显示行数（默认50）
  - `host_id`: 远程主机ID（可选）
- **使用示例**:
  - 查看Nginx日志: `logs("/var/log/nginx/access.log", 100)`
  - 查看系统日志: `logs("/var/log/syslog", 20)`

#### process - 进程管理工具
- **功能描述**: 管理系统进程，包括查看进程列表、终止进程等操作
- **适用场景**: 进程监控和问题处理
- **参数**:
  - `op`: 操作类型（list/kill）
  - `pid`: 进程ID（kill操作时需要）
  - `host_id`: 远程主机ID（可选）
- **使用示例**:
  - 查看进程列表: `process("list")`
  - 终止进程: `process("kill", pid=1234)`

#### sysinfo - 系统信息查询工具
- **功能描述**: 查询系统各种资源使用情况和状态信息
- **适用场景**: 系统监控和性能分析
- **参数**:
  - `info_type`: 信息类型（mem/disk/load/net）
  - `host_id`: 远程主机ID（可选）
- **使用示例**:
  - 查看内存: `sysinfo("mem")`
  - 查看磁盘: `sysinfo("disk")`

### 2. CMDB资产管理工具

#### create_host - 创建主机记录工具
- **功能描述**: 在CMDB数据库中创建新的主机记录，用于管理服务器资产信息
- **适用场景**: 服务器资产管理
- **参数**:
  - `hostname`: 主机名
  - `ip`: 主机IP地址
  - `os`: 操作系统信息
  - `group`: 主机分组（可选）
- **使用示例**:
  - 创建Web服务器: `create_host("web-01", "192.168.1.10", "Ubuntu 20.04", "web")`

#### list_hosts - 列出所有主机工具
- **功能描述**: 获取CMDB中所有主机的列表信息
- **适用场景**: 查看当前管理的所有服务器资产
- **参数**: 无需参数
- **返回值**: 主机信息列表

#### create_host_with_account - 创建主机和账号关联工具
- **功能描述**: 同时创建主机记录和对应的SSH登录账号，建立主机与账号的关联关系
- **适用场景**: 支持远程SSH操作的基础设置
- **参数**:
  - `hostname`: 主机名
  - `ip`: 主机IP地址
  - `os`: 操作系统信息
  - `group`: 主机分组
  - `username`: SSH登录用户名
  - `password`: SSH登录密码

#### delete_host - 删除主机记录工具
- **功能描述**: 从CMDB中删除指定的主机记录，同时删除关联的SSH账号信息
- **适用场景**: 清理不再管理的服务器资产
- **参数**:
  - `host_id`: 要删除的主机ID

#### fix_account_host_link - 修复账号主机关联工具
- **功能描述**: 修复CMDB中账号与主机的关联关系
- **适用场景**: 解决数据不一致问题，确保远程操作功能正常工作
- **参数**: 无需参数

### 3. 远程管理工具

#### remote_exec - 远程命令执行工具
- **功能描述**: 通过SSH在指定远程主机上执行命令，支持所有Shell命令的远程执行
- **适用场景**: 远程服务器管理
- **参数**:
  - `host_id`: 目标主机ID
  - `command`: 要执行的Shell命令
- **使用示例**:
  - 远程查看进程: `remote_exec(1, "ps aux")`
  - 远程重启服务: `remote_exec(1, "systemctl restart nginx")`

## Action类注解

除了主要的MCP工具外，还包含以下Action类，它们提供了带日志记录的操作功能：

### ShellAction
- 执行Shell命令并记录操作日志
- 支持操作者标识和审计追踪

### SystemdAction
- 管理系统服务并记录操作日志
- 支持服务状态查询和管理操作

### LogAction
- 查看日志文件内容并记录操作日志
- 支持指定行数和文件路径

### ProcessAction
- 管理进程并记录操作日志
- 支持进程列表查看和进程终止

### SysInfoAction
- 查询系统信息并记录操作日志
- 支持多种系统资源信息查询

## 数据模型注解

### Host - 主机信息模型
- 存储服务器主机的基本信息
- 包含主机名、IP地址、操作系统和分组信息

### Service - 服务信息模型
- 存储主机上运行的服务信息
- 包含服务名称、端口、状态等

### Account - 账号信息模型
- 存储SSH登录账号信息
- 支持密码和公钥两种认证方式

### OperationLog - 操作日志模型
- 记录所有系统操作的日志信息
- 用于审计追踪和问题排查

## 使用建议

1. **工具选择**: 根据具体需求选择合适的工具，本地操作使用不带host_id参数的工具，远程操作使用带host_id参数的工具

2. **参数验证**: 使用工具前确保参数格式正确，特别是文件路径、服务名称等

3. **权限管理**: 远程操作需要确保主机已配置正确的SSH账号信息

4. **日志追踪**: 所有Action类操作都会自动记录日志，便于审计和问题排查

5. **批量操作**: 可以通过主机分组实现批量服务器操作

## 技术架构

- **框架**: 基于FastMCP框架
- **数据库**: SQLite数据库存储
- **ORM**: SQLModel ORM框架
- **远程连接**: Paramiko SSH客户端
- **日志记录**: 自动记录所有操作到数据库

这些详细的注解将帮助大模型更好地理解每个工具的功能和使用方法，提高工具调用的准确性和效率。 